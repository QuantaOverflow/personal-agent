# ğŸ¤– AI èŠå¤©ä»£ç†å¯åŠ¨å¥—ä»¶

![agents-header](https://github.com/user-attachments/assets/f6d99eeb-1803-4495-9c5e-3cf07a37b402)

<a href="https://deploy.workers.cloudflare.com/?url=https://github.com/cloudflare/agents-starter"><img src="https://deploy.workers.cloudflare.com/button" alt="Deploy to Cloudflare"/></a>

ä¸€ä¸ªä½¿ç”¨ Cloudflare ä»£ç†å¹³å°æ„å»º AI é©±åŠ¨èŠå¤©ä»£ç†çš„å¯åŠ¨æ¨¡æ¿ï¼Œç”± [`agents`](https://www.npmjs.com/package/agents) æä¾›æ”¯æŒã€‚è¯¥é¡¹ç›®ä¸ºåˆ›å»ºäº¤äº’å¼èŠå¤©ä½“éªŒæä¾›äº†åŸºç¡€ï¼Œå…·æœ‰ç°ä»£åŒ– UI å’Œå·¥å…·é›†æˆåŠŸèƒ½ï¼ŒåŒ…æ‹¬å®Œæ•´çš„ Telegram æœºå™¨äººé›†æˆã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ’¬ **äº¤äº’å¼èŠå¤©ç•Œé¢**ï¼šåŸºäº React æ„å»ºçš„ç°ä»£å“åº”å¼ Web UIï¼Œæä¾›æ— ç¼ç”¨æˆ·äº¤äº’ä½“éªŒ
- ğŸ¤– **AI åç«¯**ï¼šåˆ©ç”¨ Cloudflare Workers å’Œ Durable Objects å®ç°å¯æ‰©å±•ä¸”æŒä¹…çš„ AI èŠå¤©ä¼šè¯
- ğŸ› ï¸ **å¯æ‰©å±•å·¥å…·ç³»ç»Ÿ**ï¼š
  - **è‡ªåŠ¨æ‰§è¡Œå·¥å…·**ï¼šæ— éœ€ç”¨æˆ·å¹²é¢„å³å¯æ‰§è¡Œæ“ä½œçš„å·¥å…·ï¼ˆå¦‚è·å–å½“å‰æ—¶é—´ã€å®‰æ’ä»»åŠ¡ï¼‰
  - **äººå·¥ç¡®è®¤å·¥å…·**ï¼šéœ€è¦ç”¨æˆ·æ˜ç¡®æ‰¹å‡†æ‰èƒ½æ‰§è¡Œçš„å·¥å…·ï¼Œå¢å¼ºå®‰å…¨æ€§å’Œæ§åˆ¶åŠ›
- ğŸ“… **é«˜çº§ä»»åŠ¡è°ƒåº¦**ï¼šæ”¯æŒä¸€æ¬¡æ€§ã€å»¶è¿Ÿå’Œå®šæœŸä»»åŠ¡ï¼ŒåŒ…å«å®Œæ•´çš„åˆ—è¡¨ã€å–æ¶ˆå’Œæ¸…ç†åŠŸèƒ½
- ğŸ“± **Telegram é›†æˆ**ï¼š
  - **Webhook å¤„ç†**ï¼šå¤„ç†ä¼ å…¥çš„ Telegram æ¶ˆæ¯å’Œæ›´æ–°
  - **æœºå™¨äºº API å®¢æˆ·ç«¯**ï¼šç®¡ç†å‘ Telegram å‘é€æ¶ˆæ¯å’Œ UI æ›´æ–°
  - **æµå¼å“åº”**ï¼šå®æ—¶å‘ Telegram ç”¨æˆ·ä¼ é€’ AI å“åº”ï¼Œå…·æœ‰æ¶ˆæ¯ç¼–è¾‘åŠŸèƒ½
  - **é€Ÿç‡é™åˆ¶å’Œé”™è¯¯æ¢å¤**ï¼šåŒ…å«å¤æ‚çš„æœºåˆ¶æ¥å¤„ç† API é™åˆ¶å’Œç¬æ€é”™è¯¯
  - **UI ç®¡ç†**ï¼šæ”¯æŒ Telegram ç‰¹å®šçš„ UI å…ƒç´ ï¼Œå¦‚å·¥å…·ç¡®è®¤çš„å†…è”é”®ç›˜
- ğŸŒ“ **ä¸»é¢˜æ”¯æŒ**ï¼šWeb UI ä¸­çš„æ˜æš—ä¸»é¢˜åˆ‡æ¢
- âš¡ï¸ **å®æ—¶æµå¼å“åº”**ï¼šå‡å°‘æ„ŸçŸ¥å»¶è¿Ÿçš„å¢é‡æ¶ˆæ¯æ›´æ–°
- ğŸ”„ **çŠ¶æ€ç®¡ç†**ï¼šä½¿ç”¨ Cloudflare Durable Objects æŒä¹…å­˜å‚¨å¯¹è¯å†å²å’Œä»£ç†çŠ¶æ€
- ğŸ¨ **ç°ä»£å“åº”å¼ UI**ï¼šåŸºäº Tailwind CSS çš„ç¾è§‚ç•Œé¢è®¾è®¡
- ğŸ“Š **å…¨é¢æ—¥å¿—è®°å½•**ï¼šé›†æˆæ—¥å¿—ä¸­é—´ä»¶ç”¨äºè·Ÿè¸ª AI æ¨¡å‹è¾“å…¥å’Œè¾“å‡º

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æ•´ä½“æ¶æ„

ç³»ç»Ÿé‡‡ç”¨æ¸…æ™°çš„å…³æ³¨ç‚¹åˆ†ç¦»è®¾è®¡ï¼š

1. **å‰ç«¯ UIï¼ˆWeb/Telegramï¼‰**ï¼šå¤„ç†ç”¨æˆ·äº¤äº’
   - **Web UI**ï¼šç”¨äºç›´æ¥èŠå¤©äº¤äº’çš„ React åº”ç”¨ç¨‹åº
   - **Telegram æœºå™¨äºº**ï¼šä½œä¸ºæ¶ˆæ¯æ¥å£ï¼Œå¤„ç†æ¥è‡ª Telegram çš„ç”¨æˆ·å‘½ä»¤å’Œæ¶ˆæ¯

2. **Cloudflare Worker / Durable Objectï¼ˆåç«¯é€»è¾‘ï¼‰**ï¼šæ‰˜ç®¡åœ¨ Cloudflare å…¨çƒç½‘ç»œä¸Šçš„ AI ä»£ç†æ ¸å¿ƒ
   - **`Chat` Durable Object**ï¼šæ¯ä¸ªå¯¹è¯çš„æŒä¹…å•å®ä¾‹å¯¹è±¡ï¼Œç»´æŠ¤å¯¹è¯å†å²å’Œä»£ç†çŠ¶æ€
   - **AI æ¨¡å‹é›†æˆ**ï¼šä¸å¤–éƒ¨ AI æä¾›å•†ï¼ˆå¦‚ OpenAIï¼‰é€šä¿¡
   - **å·¥å…·æ‰§è¡Œ**ï¼šåŒ…å«åŸºäº AI æ¨¡å‹å†³ç­–æ‰§è¡Œå„ç§å·¥å…·çš„é€»è¾‘

3. **å¤–éƒ¨ API**ï¼šOpenAIã€OpenWeatherMap å’Œ Telegram Bot API ç­‰æœåŠ¡

## ğŸ“‹ å‰ç½®æ¡ä»¶

å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨æ‹¥æœ‰ï¼š

- Cloudflare è´¦æˆ·
- OpenAI API å¯†é’¥ï¼ˆæˆ–å…¶ä»– AI æ¨¡å‹æä¾›å•†çš„å¯†é’¥ï¼‰
- Telegram Bot Tokenï¼ˆå¦‚æœæ‰“ç®—ä½¿ç”¨ Telegram é›†æˆï¼‰
- OpenWeatherMap API å¯†é’¥ï¼ˆç”¨äºå¤©æ°”åŠŸèƒ½ï¼‰
- å·²å®‰è£… Node.js å’Œ npm

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºæ–°é¡¹ç›®

```bash
npx create-cloudflare@latest --template cloudflare/agents-starter
```

### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

### 3. é…ç½®ç¯å¢ƒ

åˆ›å»º `.dev.vars` æ–‡ä»¶ï¼š

```env
OPENAI_API_KEY=your_openai_api_key
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
OPENWEATHER_API_KEY=your_openweather_api_key
```

**ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆæ¨èï¼‰**ï¼š

```bash
# è®¾ç½® Cloudflare Workers å¯†é’¥
npx wrangler secret put OPENAI_API_KEY
npx wrangler secret put TELEGRAM_BOT_TOKEN
npx wrangler secret put OPENWEATHER_API_KEY
```

### 4. æœ¬åœ°è¿è¡Œ

```bash
npm start
```

è®¿é—® `http://localhost:5173` æŸ¥çœ‹ Web ç•Œé¢ã€‚

### 5. éƒ¨ç½²

```bash
npm run deploy
```

### 6. Telegram Webhook è®¾ç½®

éƒ¨ç½²åï¼Œè®¾ç½® Telegram webhookï¼š

```bash
curl -F "url=YOUR_WORKER_URL/telegram/webhook" https://api.telegram.org/botYOUR_BOT_TOKEN/setWebhook
```

ä¾‹å¦‚ï¼š
```bash
curl -F "url=https://my-chat-agent.my-user.workers.dev/telegram/webhook" https://api.telegram.org/bot7757487340:AAF-crV6olrBN7kzyki5mji_hMKFBoru10g/setWebhook
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
src/telegram/
â”œâ”€â”€ core/                    # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ bot.ts              # Telegram Bot API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ handlers.ts         # ä¸»è¦çš„ webhook å¤„ç†å™¨
â”‚   â””â”€â”€ validation.ts       # è¯·æ±‚éªŒè¯é€»è¾‘
â”œâ”€â”€ infrastructure/          # åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ rate-limiter.ts     # é«˜çº§é€Ÿç‡é™åˆ¶å™¨ï¼ˆä»æ ¹ç›®å½•ç§»åŠ¨ï¼‰
â”‚   â””â”€â”€ ui-manager.ts       # UI ç®¡ç†å™¨
â”œâ”€â”€ messaging/              # æ¶ˆæ¯å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ commands.ts         # å‘½ä»¤å¤„ç†
â”‚   â”œâ”€â”€ converter.ts        # æ¶ˆæ¯è½¬æ¢å™¨
â”‚   â””â”€â”€ formatters/         # æ ¼å¼åŒ–å™¨
â”‚       â”œâ”€â”€ base.ts
â”‚       â”œâ”€â”€ index.ts
â”‚       â”œâ”€â”€ result.ts
â”‚       â””â”€â”€ schedule.ts
â”œâ”€â”€ streaming/              # æµå¼å“åº”æ¨¡å—
â”‚   â”œâ”€â”€ error-recovery.ts   # é”™è¯¯æ¢å¤ç®¡ç†ï¼ˆä»æ ¹ç›®å½•ç§»åŠ¨ï¼‰
â”‚   â”œâ”€â”€ handler.ts          # æµå¼å“åº”å¤„ç†å™¨
â”‚   â””â”€â”€ state-manager.ts    # çŠ¶æ€ç®¡ç†å™¨ï¼ˆä»æ ¹ç›®å½•ç§»åŠ¨ï¼‰
â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ demo.ts            # æ¼”ç¤ºå‡½æ•°ï¼ˆæ–°åˆ›å»ºï¼‰
â”œâ”€â”€ index.ts               # ä¸»å¯¼å‡ºæ–‡ä»¶
â””â”€â”€ types.ts               # ç±»å‹å®šä¹‰
```

## ğŸ› ï¸ å·¥å…·ç³»ç»Ÿ

### è‡ªåŠ¨æ‰§è¡Œå·¥å…·

è¿™äº›å·¥å…·åŒ…å« `execute` å‡½æ•°ï¼Œç”± AI ä»£ç†ç›´æ¥è¿è¡Œï¼š

- `getLocalTime`ï¼šè·å–æŒ‡å®šä½ç½®çš„å½“å‰æœ¬åœ°æ—¶é—´
- `scheduleTask`ï¼šåˆ›å»ºè®¡åˆ’æé†’æˆ–ä»»åŠ¡
- `getScheduledTasks`ï¼šåˆ—å‡ºæ‰€æœ‰å¾…å¤„ç†çš„è®¡åˆ’ä»»åŠ¡
- `cancelScheduledTask`ï¼šæŒ‰æè¿°æˆ– ID å–æ¶ˆç‰¹å®šè®¡åˆ’ä»»åŠ¡
- `cleanupExpiredTasks`ï¼šæ¸…ç†å·²è¿‡æœŸçš„ä»»åŠ¡
- `viewConversationStats`ï¼šæ£€ç´¢å½“å‰å¯¹è¯çš„ç»Ÿè®¡ä¿¡æ¯
- `clearConversationHistory`ï¼šæ¸…é™¤å¯¹è¯ä¸­çš„æ‰€æœ‰å†å²æ¶ˆæ¯
- `getWeatherInformation`ï¼šè·å–åŸå¸‚çš„å®æ—¶å¤©æ°”æ•°æ®
- `getWeatherForecast`ï¼šè·å–åŸå¸‚çš„ 5 å¤©å¤©æ°”é¢„æŠ¥

### äººå·¥ç¡®è®¤å·¥å…·

è¿™äº›å·¥å…·éœ€è¦ç”¨æˆ·æ˜ç¡®æ‰¹å‡†æ‰èƒ½æ‰§è¡Œï¼š

- `searchDatabase`ï¼šæœç´¢æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®åº“ï¼ˆç¤ºä¾‹å·¥å…·ï¼‰

### æ·»åŠ æ–°å·¥å…·

åœ¨ `src/tools/` ç›®å½•ä¸­å®šä¹‰æ–°å·¥å…·ï¼š

```typescript
// è‡ªåŠ¨æ‰§è¡Œå·¥å…·ç¤ºä¾‹
const getCurrentTime = tool({
  description: "è·å–å½“å‰æœåŠ¡å™¨æ—¶é—´",
  parameters: z.object({}),
  execute: async () => new Date().toISOString(),
});

// éœ€è¦ç¡®è®¤çš„å·¥å…·ç¤ºä¾‹
const searchDatabase = tool({
  description: "æœç´¢æ•°æ®åº“ä¸­çš„ç”¨æˆ·è®°å½•",
  parameters: z.object({
    query: z.string(),
    limit: z.number().optional(),
  }),
  // æ²¡æœ‰ execute å‡½æ•° = éœ€è¦ç¡®è®¤
});
```

## ğŸ“± ä½¿ç”¨ç¤ºä¾‹

### Web UI äº¤äº’

1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åº”ç”¨ç¨‹åº
2. å¼€å§‹å¯¹è¯ï¼š
   - "ä½ å¥½ï¼Œä½ æ˜¯è°ï¼Ÿ"
   - "ä¼¦æ•¦çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
   - "å‘Šè¯‰æˆ‘ä¸œäº¬çš„å½“å‰æ—¶é—´"
   - "5åˆ†é’Ÿåæé†’æˆ‘å–æ°´"
   - "æ˜¾ç¤ºæˆ‘çš„ä»»åŠ¡"

### Telegram æœºå™¨äººäº¤äº’

1. **åŸºæœ¬å‘½ä»¤**ï¼š
   - `/start`ï¼šåˆå§‹åŒ–æ–°å¯¹è¯
   - `/help`ï¼šæ˜¾ç¤ºæœºå™¨äººæ¶æ„ä¿¡æ¯
   - `/testconfirm`ï¼šæ¼”ç¤ºå·¥å…·ç¡®è®¤ UI
   - `/teststream`ï¼šå¯åŠ¨æµå¼å“åº”æµ‹è¯•

2. **è‡ªç„¶è¯­è¨€æŸ¥è¯¢**ï¼š
   - **å¤©æ°”æŸ¥è¯¢**ï¼š
     - "åŒ—äº¬çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
     - "ä¸Šæµ·æœªæ¥å‡ å¤©å¤©æ°”é¢„æŠ¥"
   - **æ—¶é—´æŸ¥è¯¢**ï¼š
     - "ä¸œäº¬ç°åœ¨å‡ ç‚¹ï¼Ÿ"
     - "å½“å‰åŒ—äº¬æ—¶é—´"
   - **ä»»åŠ¡ç®¡ç†**ï¼š
     - "æé†’æˆ‘æ˜å¤©æ—©ä¸Š8ç‚¹å¼€ä¼š"
     - "5åˆ†é’Ÿåæé†’æˆ‘å–æ°´"
     - "æŸ¥çœ‹æˆ‘çš„ä»»åŠ¡"
     - "å–æ¶ˆå–æ°´æé†’"

## ğŸ”§ è‡ªå®šä¹‰æŒ‡å—

### æ›´æ¢ AI æ¨¡å‹æä¾›å•†

é¡¹ç›®é»˜è®¤ä½¿ç”¨ `@ai-sdk/openai`ã€‚æ‚¨å¯ä»¥åˆ‡æ¢åˆ°å…¶ä»–æä¾›å•†ï¼š

1. å®‰è£…æ–°çš„æä¾›å•†åŒ…ï¼š
```bash
npm install workers-ai-provider
```

2. æ›´æ–° `src/server.ts`ï¼š
```typescript
// æ›´æ”¹å¯¼å…¥
import { createWorkersAI } from 'workers-ai-provider';

// åˆ›å»º Workers AI å®ä¾‹
const workersai = createWorkersAI({ binding: env.AI });
const model = workersai("@cf/deepseek-ai/deepseek-r1-distill-qwen-32b");
```

3. æ›´æ–° `wrangler.jsonc`ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰ï¼š
```jsonc
{
  "ai": {
    "binding": "AI"
  }
}
```

### ä¿®æ”¹ UI

- **`src/app.tsx`**ï¼šåŒ…å«ä¸»è¦èŠå¤©ç•Œé¢é€»è¾‘
- **`src/components/`**ï¼šå¯é‡ç”¨çš„ UI ç»„ä»¶
- **`src/styles.css`**ï¼šä½¿ç”¨ Tailwind CSS çš„åº”ç”¨ç¨‹åºæ ·å¼

## ğŸ¯ ç¤ºä¾‹ç”¨ä¾‹

1. **å®¢æœä»£ç†**ï¼šç¥¨åŠ¡åˆ›å»º/æŸ¥æ‰¾ã€è®¢å•çŠ¶æ€æ£€æŸ¥ã€äº§å“æ¨è
2. **å¼€å‘åŠ©æ‰‹**ï¼šä»£ç æ£€æŸ¥ã€Git æ“ä½œã€æ–‡æ¡£æœç´¢
3. **æ•°æ®åˆ†æåŠ©æ‰‹**ï¼šæ•°æ®åº“æŸ¥è¯¢ã€æ•°æ®å¯è§†åŒ–ã€ç»Ÿè®¡åˆ†æ
4. **ä¸ªäººç”Ÿäº§åŠ›åŠ©æ‰‹**ï¼šä»»åŠ¡è°ƒåº¦ã€ä»»åŠ¡è·Ÿè¸ªã€é‚®ä»¶èµ·è‰
5. **è°ƒåº¦åŠ©æ‰‹**ï¼šä¸€æ¬¡æ€§äº‹ä»¶è°ƒåº¦ã€å»¶è¿Ÿä»»åŠ¡æ‰§è¡Œã€å®šæœŸä»»åŠ¡

## ğŸ” æ•…éšœæ’é™¤

- **ç¼ºå°‘ API å¯†é’¥**ï¼šæ£€æŸ¥ `.dev.vars` æ–‡ä»¶å’Œ Cloudflare Worker å¯†é’¥é…ç½®
- **Telegram Webhook é”™è¯¯**ï¼šç¡®ä¿ webhook URL æ­£ç¡®è®¾ç½®ä¸”å¯ä» Telegram è®¿é—®
- **é€Ÿç‡é™åˆ¶**ï¼šç³»ç»ŸåŒ…å«å¼ºå¤§çš„é€Ÿç‡é™åˆ¶ï¼Œä¼šè‡ªåŠ¨é€€é¿
- **Durable Object çŠ¶æ€é—®é¢˜**ï¼šéªŒè¯ `wrangler.jsonc` ä¸­çš„ç»‘å®šé…ç½®

## ğŸ“š äº†è§£æ›´å¤š

- [`agents`](https://github.com/cloudflare/agents/blob/main/packages/agents/README.md)
- [Cloudflare Agents æ–‡æ¡£](https://developers.cloudflare.com/agents/)
- [Cloudflare Workers æ–‡æ¡£](https://developers.cloudflare.com/workers/)

## ğŸ“„ è®¸å¯è¯

MIT
